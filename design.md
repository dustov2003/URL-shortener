# 1. Описать идею в 1-2 предложениях.
Идея фичи `"VIP ссылка"` дать пользователю возможноть создавать свои кастомные short-code.
Также удаление записей в БД у которых истёк `time_to_live`.

# 2. Сформулировать продуктовые гипотезы: 1-2 штуки в формате если <действие> то <следствие> потому что <объяснение>.

Если пользователю будет доступна "vip ссылка", то он будет чаще выбирать наш сервис, чем аналоги, потому что ему проще будет использовать и запомнить short-code, который он сам написал.

Если пользователю будет доступна "vip ссылка", то увеличится их активность, потому что они получат больше контроля, персонализации и "красивые" для пользователя собственные ссылки.

# 3. Оценить примерные трудозатраты на полноценную реализацию в бэкенде (попробуй аргументировать оценку, например, требуемым количеством новых классов, объемом кода).

Реализация фичи была чуть ниже средней по трудозатратности, так как кода написано немного, новых классов не было создано вообще, лишь новые поля в уже существующем классе и новая колонка в существующей БД.
Самым трудозатратным лично для меня был процесс в том, чтобы разобраться в коде и проваленных тестах. Но это лишь потому-что я изначально не сильно хорошо знал FastApi и sqlalchemy.
Но а с тестами я смог разобраться относительно быстро. Но отмечу, что в тесте test_time_to_live_expiration используется datetime.now(), а в схеме Url используется func.now(), как оказалось проблема в том, что они используют разные таймзоны, вообще была идея просто изменить func.now() на datetime.now() в коде, но я не стал так делать, потому что мне кажется не просто так там именно func.now(), в таком случае в реальной практике вообще было бы хорошо мне обратиться к человеку который написал этот код и узнать причину и после решить как поступать (а так пока-что там костыль, по моему).
Иных сложных проблем не было.
Оценил бы весь путь в 2-4 недели, с учётом реализации фичи, написания тестов, добавления миграции, проведения тестов, документирование.


# 4. Придумать, можно ли сделать MVP, если да, то как оно будет выглядеть и сколько это займет времени.

MVP можно реализовать следующим образом:

Создать эндпоинт, который позволяет пользователю указывать желаемую комбинацию символов для короткой ссылки.
Валидация пользовательского ввода и проверка доступности указанной комбинации символов.
Сохранение новой ссылки в базе данных, если комбинация свободна.
Время на реализацию MVP: 4-6 дней.



# 5. Проработать архитектуру и описать ее в тексте.
Архитектура фичи простая. Были добавлены поля `vip_key`,`time_to_live`,`time_to_live_unit` в тело запроса.
А в таблицу `url_storage` было добавлена колонка `dt_deleted`, хранящая дату и время истечения `ttl`.

Логика `vip_key` заключена в том, что идёт сначала проверка на существование `long_url`, если такой url существует в бд и его `ttl` не истёк,
то возвращается его short_code.
далее идёт проверка на существование в таблице `short_code` равному `vip_key`, если существует, то возвращается ошибка.
Далее идёт проверка на `ttl`, если `ttl` превышает 2 дня, то возвращаем ошибку.

Логика истечения ttl заключается в том, что при получении данных из БД мы просто ставим доп условие, что срок жизни ссылки не истёк.
То есть в БД ещё хранится эта запись и не удалена, это сделано для того, чтобы оптимизировать работу с БД.
Но чтобы не хранить истёкшие записи, то можно в отдельном потоке просто
добавить удаление в интервал времени (интервал выбирается в зависимости от нагруженности сервиса).
То есть допусти раз в день мы очищаем БД от записей с истёкшим `ttl`.
Или же можно добавить переменную хранящую последнее очищение БД от устаревших записей и при каждом запросе на сервер,
проверять прошёл ли интервал времени для очистки от устарешвших данных, если интервал прошёл, то очищаем и обновляем переменную.
Каких-то больших различий в обоих методах нет, оба не реализованы в коде.

Остальная логика не была затронута, лишь в `delete_link` добавлено доп условие для удаления (проверка на истечение `ttl`).



# 6. Реализовать полное решение идеи в коде. Это та часть работы, которая будет проверена автотестированием.

Идея реализована.

# 7. Добиться, чтобы все предоставленны условие в исходном репозитории тесты на vip-ссылки проходили успешно, внося правки в код сервиса, а не тестов :)

Все тесты были пройдены



# 8. Придумать АБ-тест: какие выборки пользователей будут в эксперименте? Какие параметры фичи будем проверять в каждой выборке?

Выборок пользователей было бы две:
 - Пользователи которые НЕ имеют доступ к фиче "VIP ссылка"
 - Пользователи которые имеют доступ к фиче "VIP ссылка"

Какие параметры можно было бы использовать:
- количество созданных ссылок
- количество кликов


# 9. Выбрать и описать набор наблюдаемых продуктовых метрик, по которым можно сделать вывод, что идея "взлетела". Какие значения метрик ожидаем увидеть?

Количество созданных ссылок в день
Количество новых пользователей (если доступ к сервису можно получить зарегистрировавшись)
Предполагаю следующие изменения:
Увеличение количества созданных ссылок на 20-30%.
Увеличение количества новых пользователей на 5-15%.


# 10. Сделать отчет в файле design.md в своем репозитории с ответами на эти вопросы.

Этот файл вы сейчас и читаете =)
